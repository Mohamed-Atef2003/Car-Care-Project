# نظام متجر Car Care

## نظرة عامة

متجر Car Care هو نظام تجارة إلكترونية متكامل داخل التطبيق يسمح للمستخدمين بتصفح وشراء قطع غيار السيارات والأدوات. يتم تنظيم المتجر إلى فئات مختلفة من المنتجات تشمل الإطارات والأدوات وقطع الغيار ومنتجات الزجاج. يوفر النظام ميزات مثل البحث عن المنتجات وإدارة المفضلة وعربة التسوق ومعالجة المدفوعات.

## المكونات الأساسية

### 1. مزود المتجر (Store Provider)

فئة `StoreProvider` (موجودة في `lib/providers/store_provider.dart`) تعمل كنظام إدارة الحالة المركزي للمتجر. تقوم بالتعامل مع:

- إدارة بيانات المنتجات لجميع الفئات
- وظائف عربة التسوق
- إدارة المفضلة/قائمة الرغبات
- البحث عن المنتجات والتصفية
- التكامل مع Firestore لتحميل البيانات

```dart
// الوظائف الرئيسية في StoreProvider:
Future<void> initialize() async {
  await loadTires();
  await loadTools();
  await loadSpareParts();
  await loadGlass();
  notifyListeners();
}

// طرق إدارة عربة التسوق
void addToCart(StoreProduct product) { ... }
void removeFromCart(String id) { ... }
void updateQuantity(String id, int quantity) { ... }
void clearCart() { ... }

// طرق إدارة المفضلة
void toggleFavorite(StoreProduct product) { ... }
bool isFavorite(String id) { ... }
```

### 2. نماذج البيانات

جميع المنتجات في المتجر تمتد من الفئة المجردة `StoreProduct` (في `lib/models/store/store_product.dart`)، والتي تحدد الخصائص المشتركة:

```dart
abstract class StoreProduct {
  final String id;
  final String name;
  final String category;
  final String brand;
  final double price;
  final double? oldPrice;
  final double rating;
  // ... المزيد من الخصائص
  
  // طرق مساعدة لواجهة المستخدم
  bool get isDiscounted => hasDiscount && discountPercentage > 0;
  double get actualPrice => isDiscounted ? price * (1 - discountPercentage / 100) : price;
}
```

فئات المنتجات المحددة تمتد من هذه الفئة الأساسية:
- `Tire` - منتجات الإطارات مع الحجم والنوع وتوافق المركبة
- `Tool` - أدوات ومعدات السيارات
- `SparePart` - قطع غيار المركبات مع معلومات التوافق
- `GlassProduct` - منتجات زجاج السيارات مثل الزجاج الأمامي

### 3. شاشات المتجر

#### شاشة المتجر الأساسية

توفر `BaseStoreScreen` (`lib/screens/store/base_store_screen.dart`) الوظائف المشتركة لجميع شاشات فئات المنتجات:
- وظيفة البحث
- تصفية المنتجات
- واجهة المستخدم لعرض المنتجات
- إضافة إلى عربة التسوق وإجراءات المفضلة

#### شاشات الفئات المحددة

يتضمن المتجر شاشات متخصصة لفئات المنتجات المختلفة:
- `TiresScreen`
- `ToolsScreen`
- `SparePartsScreen`
- `GlassScreen`

كل منها يمتد الوظائف الأساسية مع إضافة ميزات ومرشحات خاصة بالفئة.

#### شاشة تفاصيل المنتج

توفر `ProductDetailsScreen` (`lib/screens/store/product_details_screen.dart`) معلومات مفصلة عن المنتج المحدد بما في ذلك:
- صور المنتج مع عرض شرائح
- معلومات السعر والخصم
- مواصفات وميزات المنتج
- اختيار الكمية
- وظيفة إضافة إلى عربة التسوق
- إضافة/إزالة من المفضلة

#### شاشة عربة التسوق

تسمح `CartScreen` (`lib/screens/store/cart_screen.dart`) للمستخدمين بـ:
- عرض جميع المنتجات المضافة إلى عربة التسوق
- تحديث كميات المنتجات
- إزالة العناصر من عربة التسوق
- رؤية إجمالي الطلب
- المتابعة إلى الدفع
- تفريغ عربة التسوق مع تأكيد

#### شاشة المفضلة

تسمح `FavoritesScreen` للمستخدمين بـ:
- عرض جميع المنتجات المحددة كمفضلة
- إضافة المنتجات المفضلة إلى عربة التسوق
- إزالة العناصر من المفضلة
- عرض تفاصيل المنتج

## تدفقات المستخدم

### 1. تصفح المنتجات

1. ينتقل المستخدم إلى قسم المتجر
2. يختار المستخدم فئة المنتج (إطارات، أدوات، قطع غيار، أو زجاج)
3. يمكن للمستخدم:
   - التمرير عبر قوائم المنتجات
   - استخدام وظيفة البحث للعثور على منتجات محددة
   - تصفية المنتجات بناءً على معايير خاصة بالفئة

### 2. التفاعل مع المنتج

1. ينقر المستخدم على منتج لعرض التفاصيل
2. في شاشة تفاصيل المنتج، يمكن للمستخدم:
   - عرض صور متعددة للمنتج
   - قراءة وصف المنتج والمواصفات
   - رؤية معلومات التسعير والخصم
   - إضافة المنتج إلى عربة التسوق بالكمية المحددة
   - إضافة أو إزالة المنتج من المفضلة

### 3. عربة التسوق والدفع

1. يضيف المستخدم منتجات إلى عربة التسوق من شاشات مختلفة
2. ينتقل المستخدم إلى شاشة عربة التسوق لمراجعة العناصر المحددة
3. يمكن للمستخدم تحديث الكميات أو إزالة العناصر
4. يتابع المستخدم إلى الدفع
5. يتم تمرير معلومات عربة التسوق إلى نظام الدفع
6. يكمل المستخدم الدفع من خلال بوابة الدفع المتكاملة
7. يتم تأكيد الطلب وتفريغ عربة التسوق

## التكامل مع نظام الدفع

يتكامل نظام المتجر مع نظام الدفع من خلال:
- إنشاء ملخصات الدفع من بيانات عربة التسوق
- حساب الإجماليات الفرعية والضرائب والمجموع
- تمرير معلومات الطلب إلى نظام معالجة الدفع
- معالجة تأكيد الدفع والنتائج

## تفاصيل التنفيذ التقني

### إدارة الحالة

يستخدم التطبيق حزمة Provider لإدارة الحالة:
- يحافظ `StoreProvider` على الحالة العامة للمتجر
- تتفاعل مكونات واجهة المستخدم مع تغييرات الحالة للتحديثات في الوقت الفعلي

### تحميل البيانات

يتم تحميل المنتجات من Firestore:
- يتعامل `FirestoreService` مع استعلامات قاعدة البيانات
- يتم تخزين المنتجات مؤقتًا في المزود لأداء أفضل
- تحافظ طرق التحميل الخاصة بالفئة على تنظيم البيانات بشكل نظيف

### البحث والتصفية

ينفذ المتجر البحث والتصفية بكفاءة:
- بحث نصي عبر أسماء المنتجات والأوصاف
- مرشحات خاصة بالفئة لاكتشاف المنتجات المستهدفة
- يتم عرض النتائج في تخطيط شبكة متناسق

## التحسينات المستقبلية

تشمل التحسينات المحتملة لنظام المتجر:
- مراجعات وتقييمات المستخدمين
- منتجات موصى بها بناءً على سجل التصفح
- وظائف سجل الطلبات وإعادة الطلب
- خيارات تصفية متقدمة
- ميزة مقارنة المنتجات
- إشعارات توفر المخزون 
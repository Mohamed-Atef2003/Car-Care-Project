# نظام الخدمات في تطبيق Car Care

## نظرة عامة

يقدم تطبيق Car Care مجموعة شاملة من الخدمات المتنوعة التي تلبي جميع احتياجات صيانة وإصلاح السيارات. يتميز النظام بتصميم مرن وشامل يتيح للمستخدمين طلب مجموعة واسعة من الخدمات، من الإصلاحات البسيطة إلى عمليات الصيانة المعقدة، بالإضافة إلى خدمات الطوارئ والدعم.

## المكونات الرئيسية

### 1. هيكل الخدمات

يتكون نظام الخدمات من عدة فئات رئيسية:

- **خدمات الصيانة الدورية**: تشمل تغيير الزيت والفلاتر والفحوصات الدورية.
- **خدمات الإصلاح**: تشمل إصلاح المحرك وأنظمة التعليق والفرامل وغيرها.
- **خدمات الطوارئ**: مثل المساعدة على الطريق وسحب السيارات وتغيير البطاريات.
- **خدمات الكهرباء**: صيانة وإصلاح جميع الأنظمة الكهربائية في السيارة.
- **خدمات تكييف الهواء**: صيانة وإصلاح نظام التكييف.
- **خدمات الإطارات والعجلات**: تبديل وموازنة الإطارات وإصلاحها.
- **خدمات برمجة المفاتيح**: برمجة وإصلاح مفاتيح السيارات.
- **خدمات الدعم**: دعم العملاء ومساعدة الذكاء الاصطناعي.

### 2. صفحات الخدمات

يتميز نظام الخدمات بمجموعة من الشاشات المتخصصة:

#### صفحة تفاصيل الخدمة (ServiceDetailPage)

هذه الصفحة موجودة في `service_detail_page.dart` وتعمل كقالب موحد لعرض تفاصيل أي خدمة مع:

- عرض وصفي للخدمة ومميزاتها
- باقات مختلفة بأسعار متنوعة
- إمكانية اختيار الباقة المناسبة
- زر لطلب الخدمة والانتقال إلى صفحة الدفع

```dart
class ServiceDetailPage extends StatefulWidget {
  final IconData icon;
  final String title;
  final Color color;
  final List<Map<String, String>> features;
  final List<Map<String, dynamic>> packages;
  
  // ... constructor and other methods
}
```

#### صفحة الحجز (BookingScreen)

تتيح للمستخدمين حجز موعد للصيانة أو الخدمة في أحد مراكز الخدمة المعتمدة:

- اختيار نوع الخدمة المطلوبة
- تحديد السيارة من قائمة سيارات المستخدم
- اختيار التاريخ والوقت المناسب
- اختيار مركز الخدمة
- إضافة ملاحظات إضافية

```dart
class BookingScreen extends StatefulWidget {
  final AppointmentModel? appointment;
  
  // ... constructor and implementation
}
```

#### صفحة الطوارئ (EmergencyScreen)

تقدم خدمات المساعدة الفورية في حالات الطوارئ:

- طلب المساعدة على الطريق
- خدمة سحب السيارات
- استبدال البطارية
- تغيير الإطارات
- تحديد الموقع الحالي تلقائيًا
- متابعة حالة الطلب في الوقت الفعلي
- اتصال مباشر بأرقام الطوارئ

```dart
class EmergencyScreen extends StatefulWidget {
  // ... implementation includes real-time request tracking and ETA calculation
}
```

### 3. أنواع الخدمات المتخصصة

#### خدمة تغيير الزيت (OilChangeService)

تقدم خدمات متخصصة لتغيير زيت المحرك مع:
- خيارات لأنواع زيوت مختلفة
- فحص وتغيير الفلاتر
- فحص مستويات السوائل الأخرى

#### خدمة تكييف الهواء (ACService)

تقدم خدمات صيانة وإصلاح نظام التكييف:
- فحص وشحن غاز التكييف
- تنظيف وتغيير الفلاتر
- إصلاح تسريبات الغاز
- فحص وإصلاح الكمبريسور

#### خدمة الإطارات (WheelService)

متخصصة في جميع خدمات الإطارات:
- تبديل الإطارات
- موازنة العجلات
- إصلاح البنشر
- ضبط زوايا العجلات

#### خدمة الوقود (GasolineService)

تقدم خدمات متعلقة بنظام الوقود:
- توصيل الوقود
- تنظيف نظام الوقود
- إصلاح مضخة الوقود
- فحص نظام الحقن

## شرح مفصل لكل خدمة

### 1. ملف services.dart

هذا الملف هو عبارة عن "ملف تصدير" يعمل على تجميع وتصدير جميع الملفات المتعلقة بالخدمات للمساعدة في تنظيم البنية البرمجية للتطبيق. يقوم بتصدير جميع صفحات الخدمات مما يسهل استيرادها في أجزاء أخرى من التطبيق بأمر استيراد واحد.

```dart
// صفحة تصدير لجميع ملفات الخدمات لتسهيل استيرادها
export 'service_detail_page.dart';
export 'maintenance_service.dart';
export 'painting_service.dart';
export 'washing_service.dart';
// ... باقي تصديرات الخدمات الأخرى
```

### 2. خدمة الصيانة الدورية (MaintenanceService)

توجد في ملف `maintenance_service.dart`، وهي تقدم خدمات الصيانة الدورية للسيارات وتتضمن:

- فحص شامل للسيارة بشكل دوري
- صيانة وفحص المحرك
- صيانة نظام الفرامل
- صيانة نظام التعليق
- صيانة نظام التبريد

تقدم الخدمة من خلال 3 باقات أساسية:
1. **الباقة الأساسية** (299 جنيه): تشمل الفحص الشامل وتغيير زيت المحرك والفلتر.
2. **الباقة القياسية** (599 جنيه): تشمل جميع خدمات الباقة الأساسية بالإضافة إلى استبدال فلتر الهواء وشمعات الإشعال.
3. **الباقة الشاملة** (999 جنيه): تشمل جميع خدمات الباقة القياسية بالإضافة إلى استبدال فلتر الوقود وتنظيف نظام الحقن.

### 3. خدمة الطلاء (PaintingService)

توجد في ملف `painting_service.dart`، وتقدم خدمات طلاء وتلميع السيارات وتتضمن:

- طلاء كامل للسيارة
- طلاء جزئي للسيارة
- إصلاح الخدوش
- حماية الطلاء
- تلميع ومعالجة الطلاء

تقدم الخدمة من خلال 3 باقات:
1. **باقة التلميع والحماية** (399 جنيه): تشمل تنظيف عميق للسيارة وتلميع الطلاء وإزالة الخدوش السطحية.
2. **باقة الطلاء الجزئي** (799 جنيه): تشمل طلاء جزء واحد من السيارة وإصلاح الخدوش والعلامات.
3. **باقة الطلاء الشامل** (2499 جنيه): تشمل طلاء كامل للسيارة من الخارج، وإزالة الطلاء القديم، وإصلاح أضرار الهيكل البسيطة.

### 4. خدمة الغسيل (WashingService)

توجد في ملف `washing_service.dart`، وتوفر خدمات غسيل وتنظيف السيارات بشكل شامل:

- غسيل خارجي للسيارة
- تنظيف داخلي
- تنظيف المحرك
- تلميع جسم السيارة
- تعطير السيارة من الداخل

تتوفر الخدمة ضمن 3 باقات:
1. **الغسيل الأساسي** (49 جنيه): يشمل غسيل خارجي وتلميع السيارة وتنظيف الإطارات والزجاج.
2. **الغسيل الشامل** (149 جنيه): يشمل غسيل خارجي وتنظيف داخلي وتلميع جسم السيارة وتعطير السيارة.
3. **غسيل VIP الممتاز** (299 جنيه): يشمل غسيل خارجي متقدم وتنظيف داخلي شامل وتنظيف المحرك وتطبيق طبقة حماية من الشمع.

### 5. خدمة التشخيص (DiagnosticsService)

توجد في ملف `diagnostics_service.dart`، وتقدم خدمات فحص وتشخيص أعطال السيارة:

- فحص شامل لأنظمة السيارة
- قراءة وتشخيص أكواد الأعطال
- فحص نظام المحرك والحقن
- فحص الأنظمة الكهربائية والإلكترونية
- تقرير مفصل عن حالة السيارة

### 6. خدمة تغيير الزيت (OilChangeService)

توجد في ملف `oil_change_service.dart`، وتتخصص في خدمات تغيير زيوت المحرك:

- تغيير زيت المحرك بأنواع زيوت مختلفة
- استبدال فلتر الزيت
- فحص وضبط مستويات السوائل الأخرى
- فحص عام لحالة المحرك
- إعادة ضبط مؤشر صيانة الزيت

### 7. خدمة الإصلاح (RepairService)

توجد في ملف `repair_service.dart`، وتقدم خدمات إصلاح متنوعة للسيارات:

- إصلاح أعطال المحرك
- إصلاح أنظمة نقل الحركة
- إصلاح نظام الفرامل
- إصلاح نظام التعليق
- إصلاح أنظمة التبريد

### 8. خدمة الإطارات (WheelService)

توجد في ملف `wheel_service.dart`، وتوفر خدمات شاملة للإطارات والعجلات:

- تبديل الإطارات واختيار الأنسب للسيارة
- موازنة وترصيص العجلات
- إصلاح البنشر وثقوب الإطارات
- ضبط زوايا العجلات
- فحص ضغط الإطارات
- تقييم حالة الإطارات وتقديم النصائح

تتضمن الخدمة باقات متنوعة للعناية بالإطارات والعجلات بأسعار تنافسية، مع ضمان استخدام أحدث المعدات والتقنيات.

### 9. خدمة سحب السيارات (TowingService)

توجد في ملف `towing_service.dart`، وتقدم خدمات متخصصة لسحب ونقل السيارات:

- سحب السيارات المعطلة أو المتضررة
- نقل السيارات المعطلة باستخدام شاحنات مجهزة خصيصًا
- مساعدة طارئة على الطرق السريعة
- استعادة السيارات العالقة في الرمال أو الطين
- نقل السيارات الفاخرة بمعدات متخصصة
- خدمة سحب ونقل المسافات الطويلة
- خدمة طوارئ على مدار 24 ساعة

الخدمة مقسمة إلى 4 باقات رئيسية:
1. **خدمة السحب الأساسية** (199 جنيه): تشمل سحب السيارة لمسافة تصل إلى 20 كم.
2. **خدمة السحب المتقدمة** (349 جنيه): تشمل سحب السيارة لمسافة تصل إلى 50 كم مع استجابة سريعة.
3. **خدمة السحب الشاملة** (599 جنيه): تشمل سحب السيارة لمسافة تصل إلى 100 كم مع خدمة إصلاح بسيطة.
4. **باقة النقل وخدمة الطوارئ VIP** (1299 جنيه): توفر خدمة سحب فاخرة لمسافة غير محدودة.

### 10. خدمة برمجة المفاتيح (KeyProgrammingService)

توجد في ملف `key_programming_service.dart`، وتقدم خدمات متخصصة لبرمجة مفاتيح السيارات:

- برمجة مفاتيح السيارات الحديثة
- نسخ وتكرار مفاتيح السيارات
- إصلاح وصيانة أجهزة التحكم عن بعد
- فتح السيارات المقفلة في حالات الطوارئ
- برمجة وضبط أنظمة الإنذار ومنع السرقة
- صيانة وإصلاح أقفال السيارات
- برمجة مفاتيح سيارات المرسيدس وBMW

تتوفر الخدمة ضمن 4 باقات:
1. **خدمة المفاتيح الأساسية** (149 جنيه): تشمل نسخ المفاتيح التقليدية وإصلاح بسيط للريموت.
2. **خدمة المفاتيح المتقدمة** (299 جنيه): تشمل نسخ مفاتيح الشريحة الإلكترونية وبرمجة المفاتيح الذكية.
3. **خدمة المفاتيح الاحترافية** (499 جنيه): تشمل برمجة مفاتيح السيارات الفاخرة وإصلاح أنظمة الدخول بدون مفتاح.
4. **باقة السيارات الفاخرة** (899 جنيه): توفر برمجة متخصصة للسيارات الفاخرة والرياضية.

### 11. خدمة الوقود (GasolineService)

توجد في ملف `gasoline_service.dart`، وتوفر خدمات متعلقة بنظام الوقود:

- توصيل الوقود في حالات الطوارئ
- تنظيف وصيانة نظام الوقود
- إصلاح أو استبدال مضخة الوقود
- فحص وصيانة نظام الحقن
- إصلاح تسريبات الوقود
- استبدال فلاتر الوقود

### 12. خدمة الطوارئ (EmergencyScreen)

توجد في ملف `emergency_screen.dart`، وتقدم مجموعة من خدمات المساعدة الطارئة:

- المساعدة على الطريق في حالات التعطل
- سحب السيارات المعطلة
- استبدال البطارية الفارغة
- تغيير الإطارات المثقوبة
- توصيل الوقود في حالات نفاد الوقود
- فتح السيارات المقفلة

تتميز الخدمة بنظام تتبع متقدم يعرض:
- وقت الوصول المتوقع
- حالة الطلب في الوقت الفعلي
- موقع فني الخدمة
- معلومات الاتصال بالفني

توفر الصفحة أيضًا أرقام الطوارئ الهامة وإمكانية الاتصال المباشر بها.

### 13. خدمة الكهرباء (ElectricityService)

توجد في ملف `electricity_service.dart`، وتتخصص في صيانة وإصلاح الأنظمة الكهربائية للسيارة:

- فحص وتشخيص الأعطال الكهربائية
- إصلاح وصيانة نظام الشحن
- إصلاح وصيانة نظام بدء التشغيل
- إصلاح الدوائر الكهربائية
- معايرة وإصلاح أجهزة الاستشعار
- صيانة وإصلاح نظام الإضاءة

### 14. خدمة تكييف الهواء (ACService)

توجد في ملف `ac_service.dart`، وتقدم خدمات متخصصة لصيانة وإصلاح نظام تكييف الهواء:

- فحص وتشخيص مشاكل التكييف
- إعادة شحن غاز التكييف
- إصلاح تسريبات غاز التكييف
- تنظيف وتعقيم نظام التكييف
- استبدال فلاتر المكيف
- فحص وإصلاح الكمبريسور والمكثف

### 15. صفحة مراكز الخدمة (ServiceCentersScreen)

توجد في ملف `service_centers_screen.dart`، وتعرض قائمة بمراكز الخدمة المعتمدة مع:

- موقع المركز على الخريطة
- ساعات العمل
- التقييمات والمراجعات
- الخدمات المتوفرة
- معلومات الاتصال
- إمكانية حجز موعد في المركز المختار

### 16. خدمات الدعم (SupportServicesScreen)

توجد في ملف `support_services_screen.dart`، وتوفر خدمات الدعم والمساعدة للمستخدمين من خلال:

- **خدمة العملاء**: للتواصل المباشر مع فريق دعم العملاء عبر المحادثة النصية.
- **المساعد الذكي**: للحصول على إجابات فورية للأسئلة الشائعة باستخدام الذكاء الاصطناعي.

تتميز واجهة الخدمة بالبساطة والوضوح لتسهيل وصول المستخدم إلى خدمة الدعم المناسبة.

## آلية عمل نظام الخدمات

### 1. طلب وحجز الخدمات

1. **اختيار الخدمة**: يختار المستخدم الخدمة المطلوبة من قائمة الخدمات.
2. **تحديد التفاصيل**: يتم تحديد نوع الخدمة والباقة المناسبة والسيارة المستهدفة.
3. **الحجز أو الطلب المباشر**:
   - إما حجز موعد لاحق (من خلال `BookingScreen`)
   - أو طلب الخدمة فورًا (من خلال صفحة تفاصيل الخدمة المعنية)
4. **التأكيد والدفع**: يتم توجيه المستخدم إلى صفحة الدفع لإتمام العملية.

### 2. معالجة طلبات الطوارئ

1. **تقديم الطلب**: يقدم المستخدم طلب المساعدة الطارئة من خلال `EmergencyScreen`.
2. **تحديد الموقع**: يتم تحديد الموقع الحالي باستخدام خدمات GPS.
3. **المتابعة المباشرة**: يتم تحديث حالة الطلب في الوقت الفعلي مع حساب الوقت المتبقي للوصول.
4. **إتمام الخدمة**: يتم إتمام الخدمة في الموقع وإغلاق الطلب.

### 3. التكامل مع نظام الدفع

يتم ربط طلبات الخدمة بنظام الدفع عبر:

```dart
// إعداد ملخص الدفع وتوجيه المستخدم لصفحة الدفع
final paymentSummary = PaymentSummary(
  subtotal: packagePrice,
  tax: tax,
  deliveryFee: 0.0, 
  discount: 0.0,
  total: totalAmount,
  currency: 'EGP',
  items: items,
  additionalData: additionalData,
);

Navigator.push(
  context,
  MaterialPageRoute(
    builder: (context) => PaymentDetailsScreen(
      paymentSummary: paymentSummary,
      orderId: orderId,
    ),
  ),
);
```

### 4. تتبع وإدارة المواعيد

يمكن للمستخدمين متابعة مواعيد الصيانة والخدمات من خلال شاشة `MyAppointmentsScreen` التي تعرض:
- المواعيد القادمة
- تاريخ المواعيد السابقة
- تفاصيل كل موعد
- إمكانية إلغاء أو تعديل المواعيد

## البنية التقنية

### 1. نماذج البيانات

تستخدم الخدمات عدة نماذج بيانات أساسية:

- `AppointmentModel`: يمثل موعدًا للصيانة أو الخدمة.
- `EmergencyRequest`: يمثل طلب خدمة طارئة.
- `PaymentSummary`: يحتوي على تفاصيل الدفع المتعلقة بالخدمة.
- `Car`: يمثل سيارة المستخدم التي سيتم تقديم الخدمة لها.

### 2. التكامل مع Firebase

يتم تخزين ومزامنة بيانات الخدمات والمواعيد باستخدام Firestore:

```dart
// مثال على حفظ موعد جديد
await FirebaseFirestore.instance
    .collection('appointments')
    .add({
      'customerId': customerId,
      'serviceType': _selectedService,
      'date': Timestamp.fromDate(_selectedDate),
      'time': _selectedTime,
      'vehicleId': _selectedVehicleId,
      'serviceCenterId': _serviceCenters[_selectedServiceCenter]['id'],
      'note': _noteController.text,
      'status': 'pending',
      'createdAt': Timestamp.now(),
    });
```

### 3. التفاعل مع واجهة المستخدم

يتم استخدام نمط Provider لإدارة حالة التطبيق وتسهيل تبادل البيانات بين المكونات:

```dart
// مثال على استخدام Provider للوصول إلى بيانات المستخدم
final userProvider = Provider.of<UserProvider>(context, listen: false);
final userId = userProvider.user?.id;
```

## ميزات متقدمة

### 1. خدمات المساعدة في الموقع

تتضمن بعض الخدمات مثل مساعدة الطوارئ استخدام:
- `geolocator` لتحديد الموقع الجغرافي
- `geocoding` لتحويل الإحداثيات إلى عنوان
- خرائط تفاعلية لعرض مراكز الخدمة القريبة

### 2. نظام تنبيهات وإشعارات

يتلقى المستخدمون تنبيهات حول:
- تأكيد الحجوزات
- تذكير بالمواعيد القادمة
- حالة طلبات الطوارئ
- انتهاء الخدمة وتفاصيل الفاتورة

### 3. تقييم الخدمة

بعد الانتهاء من الخدمة، يمكن للمستخدمين:
- تقييم جودة الخدمة
- تقديم ملاحظات وتعليقات
- مشاهدة تقييمات الآخرين لمراكز الخدمة

## التطويرات المستقبلية

تشمل خطط التطوير المستقبلية:
- إضافة نظام متابعة لفنيي الخدمة في الوقت الفعلي
- توفير تقديرات تكلفة أكثر دقة بناءً على حالة السيارة
- إضافة خاصية الدردشة المباشرة مع الفني المسؤول عن الخدمة
- تكامل أعمق مع نظام إدارة قطع الغيار وتوفرها
- إضافة خدمات جديدة مثل الفحص الشامل باستخدام الذكاء الاصطناعي 